<!DOCTYPE HTML>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,width=device-width,initial-scale=1.0"/>
    <meta name="format-detection" content="telephone=no,email=no,date=no,address=no">
    <meta name="renderer" content="webkit">
    <title>教工餐菜单</title>
    <script src="js/jquery-2.1.3.min.js"></script>
    <script src="js/js.js"></script>
    <script src="js/layui.js"></script>
    <link rel="stylesheet" href="css/iconfont.css">
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/css1.css">
    <link rel="stylesheet" href="css/layui.css">

</head>
<body>
    <script type="text/javascript">
      $(function () {
        $('.top .pcnone').click(function () {
          $('.top').addClass('phone');
          $('header,body').addClass('ph_fixed');
        })
        $('.logo .meau').click(function () {
          $('header .nav').addClass('show');
        })

        $('header .nav .icon-zuo').click(function () {
          $('header .nav').removeClass('show sea');
        })
        $('.logo .search').click(function () {
          $('.nav').addClass('show sea');
        })
      })
    </script>
    <section class="top">
        <div class="cont">
            <div class="l">
                <自觉遵守饭堂纪律,养成饮食卫生习惯>
            </div>
            <div class="r phone" ><a class="lang" href="javascript:;">

                <ul>
                    <li onclick="myFunction()">注销登录</li>
                    <li onclick="myFunctionupdate()">修改密码</li>
                </ul>
                <i class="xiala iconfont icon-xia"></i> </a>
            </div>
            <span class="r" id="user" ></span>
            <i class="iconfont icon-diqiu r" style="display: inline-block;margin-right: 6px"></i>
            <i class="pcnone iconfont icon-guanbi" ></i>
        </div>
    </section>
    <header>
      <div class="cont">
        <div class="logo l">
          <div class="pcnone r">
            <i class="iconfont icon-liebiao meau"></i>
            <i class="iconfont icon-search search"></i>
          </div>
        </div>
          <div class="nav r">
              <div class="pcnone tit"><i class="iconfont icon-zuo"></i>目录</div>
              <div class="navs"> <a id="index"  >首页</a> <a id="brand" >中心介绍</a> <a id="activity" class="choukuancaidan act">团体用餐预定</a><a id="teachter" >教工餐菜单</a> <a  id="gerenzhongxin">新闻中心</a>  <a  id="pinlun">餐厅风貌</a><a  id="contact" >投诉与建议</a> </div>
              <div class="pcnone log">
                  <a href="../login.html" class="hidelogin">登录</a>
                  <a href="register.html" class="hidelogin">注册</a>
                  <a href="/">注销登录</a>
                  <a href="/">修改密码</a>
              </div>
          </div>
      </div>
    </header>
    <section class="hiden" style="height: 800px;display: none;overflow: hidden;">
        <div style="color: #f00;margin-top:270px"></div>
        <p style="width: 400px;text-align: left;font-size: 20px;font-weight: bold;margin-left: 20px">预定信息：</p>
        <label style="padding-left: 20px">窗口号：</label><input class="windowvalue" type="text" placeholder="请输入窗口号" style="width: 400px;height: 50px;margin: 20px 0px"><br>
        <label style="padding-left: 20px">就餐人数：</label><input class="orderNumvalue" type="text" placeholder="请输入就餐人数" style="width: 400px;height: 50px;margin: 20px 0px"><br>
        <label style="padding-left: 20px">预约人：</label><input class="orderNamevalue" type="text" placeholder="请输入预约人" style="width: 400px;height: 50px;margin: 20px 0px"><br>
        <label style="padding-left: 20px">预订电话：</label><input class="orderPhonevalue" type="text" placeholder="请输入预订电话" style="width: 400px;height: 50px;margin: 20px 0px"><br>
        <label style="padding-left: 20px">到达时间：</label><input class="getTimevalue" type="time" placeholder="请输入达到时间" style="width: 400px;height: 50px;margin: 20px 0px"><br>
        <button style="width: 120px;height:50px;line-height: 50px;margin-left:120px;display: inline-block" onclick="exit()">取消</button>
        <button style="width: 120px;height:50px;line-height: 50px;display: inline-block;margin-left: 20px" onclick="btns()">确定</button>
    </section>
<div style="clear: both"></div>
    <section class="zbanner" style="position: relative;background: url('img/bannersfour.jpg') no-repeat center;background-size: cover" >
        <button onclick="windowbtn()" style="position: absolute;top: 380px;color:orangered;left:50%;width: 100px;height: 50px;cursor: pointer">预定</button>
    </section>
    <section class="activity" style="height: 1000px;" >
        <p style="font-size: 18px;font-weight: bold">一号窗口</p>
      <ul class="studentsmenu1"></ul>
        <p style="font-size: 18px;font-weight: bold">二号窗口</p>
        <ul class="studentsmenu2" style="float: left"></ul>
        <p style="font-size: 18px;font-weight: bold">三号窗口</p>
        <ul class="studentsmenu3"></ul>
    </section>
    <div style="clear: both"></div>
    <footer class="hidefooter">
        <div class="footer">
            <div>
                <ul>
                    <li><a href="">关于我们</a></li>
                    <li><a href="">服务条款</a></li>
                    <li><a href="">新手指南</a></li>
                    <li><a href="">个人中心</a></li>
                    <li><a href="">联系我们</a></li>
                    <li><a href="">友情链接</a></li>
                </ul>
                <p class="center">版权所有 © 爱心筹. 2020@CopyRight</p>
            </div>
        </div>
    </footer>
    <script>
        function windowbtn(){
            $('.zbanner').css('display','none')
            $('.activity').css('display','none')
            $('.hiden').css('display','block')
        };
        function exit(){
            console.log("aaa")
            $('.zbanner').css('display','block')
            $('.activity').css('display','block')
            $('.hiden').css('display','none')
            window.location.href = 'activity.html'
        };
        function btns(){
            var window = $(".windowvalue").val()
            var orderNum = $(".orderNumvalue").val()
            var orderName = $(".orderNamevalue").val()
            var orderPhone = $(".orderPhonevalue").val()
            var getTime = $(".getTimevalue").val()
            var parms={
                "window":window,
                "orderNum":orderNum,
                "orderName":orderName,
                "orderPhone":orderPhone,
                "getTime":getTime
            }
            $.ajax({
                type:'post',
                url:'http://localhost:8080/order/insert.do',
                dataType:'json',
                data:parms,
                success:function (result){
                    if(result.code === 200){
                        $('.zbanner').css('display','block')
                        $('.activity').css('display','block')
                        $('.hiden').css('display','none')
                        alert("预定成功")
                    }else if(result.code === 505){
                        alert("预定失败！请填写预约人和联系方式！")
                    }else {
                            alert("预定失败！！")
                    }

                }
            });

        };
        $("#gerenzhongxin").click(function (){
            if (sessionStorage.getItem("uesrname") !== null){
                window.location.href = 'shop.html'
            }else{
                alert("请登录！！")
                window.location.href = '../login.html'
            }
        });
        var runCallback1 = null;
        dmm({
            // index: 1,//当前页面                         默认1
            cssStyle: 1,//控件样式                       默认1
            // size: [10, 20, 30],//每页显示条数           默认[10,20]
            // skip: true,//是否显示跳转功能               默认不显示
            // setSize: true,//是否显示下拉框              默认不显示
            container: "pageParent",//控件容器id,
            //textShow: ["首页", "上一页", "下一页", "尾页", "跳转","页","确定","页数：", "总条数："],//长度必须是九个
            //回掉函数，一般就是post请求后台方法得到分页数据加载到页面上
            callback: function (e) {
                e.index;//当前页
                e.pageSize1;//页面显示条数
                var token = sessionStorage.getItem("token")
                //以上两个属性可以当作请求后台时传入的参数
                $.ajax({
                    type:'post',
                    url:'http://localhost:8080/raisinginfo/selectPassRaisingInPage.do',
                    dataType:'json',
                    headers:{"token":token},
                    data:{'currentPage': e.index, 'pageSize': e.pageSize1},
                    success:function (result){
                        console.log("aaaaaa")
                        console.log(result)
                        console.log("aaaaaa")
                        if (result.code == 200){
                            $(".act_ul").empty();
                            $.each(result.obj.pageData,function (index,elem){
                                $(".act_ul").append("<div class='act_li'><div class='act_img'><img style='width:100%;height:300px' src="+'http://localhost:8080'+elem.firstUrl+"></div><div class='act_text' style='position:relative'><h3>"+elem.raisingTitle+"</h3><p><span style='color:coral'><span style='font-size: 18px'>"+elem.targetAmount+"</span><span style='color:#444;font-size: 18px'>急需筹款（元）|</span></span><span style='color:coral;padding-left:14px'><span style='font-size: 18px'>"+elem.currentAmount+"</span><span style='color:#444;font-size: 18px'>已经筹到 &nbsp;</span></span></p><a>查看菜品</a></div></div>")
                                $(".act_text").each(function (index){
                                    $(this).find("a").addClass("juankuan"+(index+1))
                                })
                                $(".juankuan"+(index+1)).click(function(){
                                    sessionStorage.setItem("ckid", elem.id);
                                    var ckid = sessionStorage.getItem("ckid")
                                    $(".zbanner").css("display","none")
                                    $(".activity").css("display","none")
                                    $(".showplay").css("display","block")
                                    var token = sessionStorage.getItem("token")
                                    $.ajax({
                                        type:'post',
                                        url:'http://localhost:8080/raisinginfo/selectRaisingById.do',
                                        dataType:'json',
                                        headers:{"token":token},
                                        data: {'id':ckid},
                                        success:function (result){
                                            console.log(result)
                                        if (result.code=200 ){
                                            $(".choukauntitle").html(result.obj.raisingTitle)
                                            $(".raisingName").html(result.obj.raisingName)
                                            $(".jxcksum").html(result.obj.targetAmount)
                                            $(".yjcdsum").html(result.obj.currentAmount)
                                            $(".raisingDescription").html(result.obj.raisingDescription)
                                            $.each(result.obj.urls,function(index,elem){
                                                console.log(elem)
                                                $(".futu").append("<img style='width:20%;height:200px' src="+'http://localhost:8080'+elem.imageUrl+">")
                                            })

                                        }else{

                                    }
                                }
                                });
                                });
                            })

                        }
                        //以下三行在加载完页面后必须填写
                        e.countpage = Math.ceil(result.obj.totalCount / e.pageSize1);//注意必写（数据总页数——通过后台方法获取）
                        e.infocount = result.obj.totalCount;//注意必写（数据总条数——通过后台方法获取）
                        xian(e);//注意必写（加载控件）
                        //
                        //可将以下代码用于查询使用--联合dian()方法
                        runCallback1 = e;//将分页条件赋值变量
                    }
                })
            }
        });

        function dian() {
            runCallback1.index = 1;

            hui(runCallback1);//执行此分页的回掉函数（请求后台获取数据的方法）
        }

        var arrtext=[];
        var arr1=["first", "up", "next", "last", "jump", "page", "ok", "pageindex: ", "all: "];
        arrtext.push(arr1);
    </script>
    <script type="text/javascript">
        $(function() {// 初始化内容
            if(sessionStorage.getItem("role") === '学生'){
                console.log("aaa")
                $('#teachter').css('display','none')
            }
        });
      $(function () {
        $('.xiala').click(function () {
          $('.lang ul').toggle();
        })
        $('.lang ul li').click(function () {
          var text =  $(this).html();
          $('.lang span').html(text);
          $('.lang ul').hide();
        })
      })
      window.onload = function (){
          $("#index").click(function (){
              window.location.href = 'index1.html'
          })
          $("#brand").click(function (){
              window.location.href = 'brand.html'
          })
          $("#activity").click(function (){
              window.location.href = 'activity.html'
          })
          $("#gerenzhongxin").click(function (){
              window.location.href = 'shop.html'
          });
          $("#teachter").click(function (){
              window.location.href = 'teachter.html'
          });
          $("#investment").click(function (){
              window.location.href = 'investment.html'
          });
          $("#recruitment").click(function (){
              window.location.href = 'recruitment.html'
          });
          $("#pinlun").click(function (){
              window.location.href = 'pinlun.html'
          });
          $(".choukuancaidan").click(function (){
              window.location.href = 'activity.html'
          });
          $("#contact").click(function (){
              window.location.href = 'contact.html'
          })
          if (sessionStorage.getItem("uesrname") != null){
              $(".hidelogin").css('display','none');
              $(".hidelogin").css('display','none');
              $("#user").html(sessionStorage.getItem("uesrname"))
              console.log(sessionStorage.getItem("uesrname"))
          }else{
              $("#user").html("登录")
              if ( $("#user").html() == '登录'){
                  $('#user').css("cursor","pointer")
                  $('#user').click(function (){
                      window.location.href = '../login.html'
                  })
              }else{
                  console.log("用户已登录")
              }
          }
      };
      //1号窗口接口
      $.ajax({
          type:'post',
          url:'http://localhost:8080/menu/listStudentMenu.do',
          dataType:'json',
          data:{"window":1},
          success:function (result){
              console.log(result)
              if (result.code == 200){
                  $.each(result.obj,function(index,elem){
                      $(".studentsmenu1").append("<li style='width: 25%;float: left;position: relative;padding:10px 10px'> <img style='width: 100%;height: 220px' src="+'http://localhost:8080'+elem.firstUrl+"><p style='text-align: center;font-size: 18px'>"+elem.menuName+"</p></li>")
                  })
              }
          }
      });
      //2号窗口接口
      $.ajax({
          type:'post',
          url:'http://localhost:8080/menu/listStudentMenu.do',
          dataType:'json',
          data:{"window":2},
          success:function (result){
              console.log(result)
              if (result.code == 200){
                  $.each(result.obj,function(index,elem){
                      $(".studentsmenu2").append("<li style='width: 25%;float: left;position: relative;padding:10px 10px'> <img style='width: 100%;height: 220px' src="+'http://localhost:8080'+elem.firstUrl+"><p style='text-align: center;font-size: 18px'>"+elem.menuName+"</p></li>")
                  })
              }
          }
      });
      //3号窗口接口
      $.ajax({
          type:'post',
          url:'http://localhost:8080/menu/listStudentMenu.do',
          dataType:'json',
          data:{"window":3},
          success:function (result){
              console.log(result)
              if (result.code == 200){
                  $.each(result.obj,function(index,elem){
                      $(".studentsmenu3").append("<li style='width: 25%;float: left;position: relative;padding:10px 10px'> <img style='width: 100%;height: 220px' src="+'http://localhost:8080'+elem.firstUrl+"><p style='text-align: center;font-size: 18px'>"+elem.menuName+"</p></li>")
                  })
              }
          }
      });

      function myFunction() {
          var txt;
          if (confirm("是否要退出登录")) {
              txt = "您按了确定";
              sessionStorage.removeItem("role");
              sessionStorage.removeItem("uesrname");
              sessionStorage.removeItem("id");
              window.location.href = '../login.html'
          } else {
              txt = "您按了取消";
          }
      };

    </script>
    <script>
      $(".faqichoukuan").click(function (){
          $(".activity").css("display","none")
          $(".wenjianshangchuan").css("display","block")
          $(".hidefooter").css("display","none")
      });           function myFunctionupdate() {
          var txt;
          var id = sessionStorage.getItem("id");
          var password = prompt("请输入密码：");
          var passwordtwo = prompt("请再次输入密码：");
          var parms = {'id': id, 'password': password}
          if (password == null || password == "" ||passwordtwo == null || passwordtwo == "") {
              alert("密码不能为空")
          } else if(password !=passwordtwo ){
              alert("俩次输入密码不一致")
          }else{
              $.ajax({
                  type:'post',
                  url:'http://localhost:8080/userinfo/updatePassword.do',
                  data: {id:id,password:password},
                  success:function (result){
                      console.log(result)
                      if (result.code == 0){
                          alert("密码修改成功，请重新登录")
                          sessionStorage.removeItem("uesrname");
                          sessionStorage.removeItem("id");
                          window.location.href='../login.html'
                      }
                  }
              })
          }
      }
      $(".queding").click(function (){
          $(".activity").css("display","block")
          $(".wenjianshangchuan").css("display","none")
      });
    </script>
<script>
    $(".querenjuankuan").click(function (){
        var id = sessionStorage.getItem("ckid");
        var userid = sessionStorage.getItem("id");
        var token = sessionStorage.getItem("token");
        var moneys = $(".moneys").val()
        if ($(".moneys").val()!= null && $(".moneys").val() != ""){
            $.ajax({
                type:'post',
                url:'http://localhost:8080/raisinginfo/addAmount.do',
                dataType:'json',
                headers:{"token":token},
                data: {'id':id,'userId':userid,'add':moneys},
                success:function (result){
                    console.log(result)
                    if (result.code=200 ){
                        location.reload();
                        alert(result.message)
                    }else{
                        alert(result.message)
                    }
                }
            })
            // $.ajax({
            //     type:'post',
            //     url:'http://localhost:8080/raisinginfo/selectAmount.do',
            //     dataType:'json',
            //     data: {'userId':userid},
            //     success:function (result){
            //         if (result.code!=200 ){
            //             alert("超出捐款金额")
            //         }
            //     }
            // })
        }else{
            alert("请输入金额")
        }


    })
</script>
  <script>
        const token = sessionStorage.token
        // console.log(token)
        layui.use(['form','upload'], function () {
            var form = layui.form,
                layer = layui.layer,
                upload = layui.upload,
                $ = layui.$;
            // const context = layui.context;
            var hostUrl = "http://localhost:8080"
            upload.render({
                elem: '#pic' //绑定元素
                , url: hostUrl+"/file/upload.do" //上传接口
                ,headers:{"token":token}
                ,exts: 'jpg|png|jpeg'
                , done: function (res) {
                    debugger
                    console.log(res.data)
                    //上传完毕回调
                    if (res.code === 0) {

                        $('#pic_url').val(res.data);
                        //$(".pic_url").attr("src", hostUrl+res.data);
                    } else {
                        layer.msg(res.info, function () { })
                    }
                }, error: function () {
                    layer.msg("上传异常");
                }
            });
            //json的length
            function getJsonLength(jsonData){
                var jsonLength = 0;
                for(var item in jsonData){
                    jsonLength++;
                }
                return jsonLength;
            }
            var imagesUrls = ""
            upload.render({
                elem: '#test2'
                ,url: hostUrl+'/file/upload.do' //改成您自己的上传接口
                ,acceptMime: 'image/*'
                ,exts: 'jpg|png|jpeg'
                ,headers:{"token":token}
                ,multiple: true
                ,number: 3
                ,before: function(obj){
                    //预读本地文件示例，不支持ie8
                    obj.preview(function(index, file, result){
                        $('#demo2').prepend('<img style="width:30px;height:30px" src="'+ result +'" alt="'+ file.name +'" class="layui-upload-img">')
                        if ($('#demo2').children('img').length>=3){
                            $("#test2").hide();
                        }
                    });

                }
                ,done: function(res){

                    imagesUrls = imagesUrls+res.data+","
                    console.log(imagesUrls)
                    $("#imagurls").val(imagesUrls.substring(0,imagesUrls.length-1));
                    console.log($("#imagurls").val())
                    //上传完毕
                }
            });
            //监听提交
            form.on('submit(saveBtn)', function (data) {
                console.log(data.field)
                var token = sessionStorage.getItem("token");
                    $.ajax({
                        url:hostUrl+'/raisinginfo/insertRaising.do',
                        //contentType: "application/json;charset=UTF-8",
                        method:'post',
                        crossDomain: true,
                        async:false,
                        headers:{"token":token},
                        data:data.field,
                        dataType:'JSON',
                        success:function(res){
                            console.log(res)
                            layer.msg(res.msg,{
                                time: 1000, //0.8s后自动关闭
                                icon:1,
                                end:function () {
                                    var iframeIndex = parent.layer.getFrameIndex(window.name);
                                    parent.layer.close(iframeIndex);
                                }
                            });
                            $(".wenjianshangchuan").css("display","none")
                            $(".activity").css("display","block")
                        },error:function (res) {
                        }
                    }) ;
                return false;
            });

        });
    </script>
</body>
</html>
