<!DOCTYPE HTML>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,width=device-width,initial-scale=1.0"/>
    <meta name="format-detection" content="telephone=no,email=no,date=no,address=no">
    <meta name="renderer" content="webkit">
    <title>公益活动</title>
    <script src="js/jquery-2.1.3.min.js"></script>
    <script src="js/js.js"></script>
    <script src="js/layui.js"></script>
    <link rel="stylesheet" href="css/iconfont.css">
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/css1.css">
    <link rel="stylesheet" href="css/layui.css">

</head>
<body>
    <script type="text/javascript">
      $(function () {
        $('.top .pcnone').click(function () {
          $('.top').addClass('phone');
          $('header,body').addClass('ph_fixed');
        })
        $('.logo .meau').click(function () {
          $('header .nav').addClass('show');
        })

        $('header .nav .icon-zuo').click(function () {
          $('header .nav').removeClass('show sea');
        })
        $('.logo .search').click(function () {
          $('.nav').addClass('show sea');
        })
      })
    </script>
    <section class="top">
        <div class="cont">
            <div class="l">
                <只要人人的献出一点爱,世上就变成美好的人间>
            </div>
            <div class="r phone" ><a class="lang" href="javascript:;">

                <ul>
                    <li onclick="myFunction()">注销登录</li>
                    <li onclick="myFunctionupdate()">修改密码</li>
                </ul>
                <i class="xiala iconfont icon-xia"></i> </a>
                <a href="register.html"><i class="iconfont icon-zhuce reg"></i>注册</a>
            </div>
            <span class="r" id="user" ></span>
            <i class="iconfont icon-diqiu r" style="display: inline-block;margin-right: 6px"></i>
            <i class="pcnone iconfont icon-guanbi" ></i>
        </div>
    </section>
    <header>
      <div class="cont">
        <div class="logo l">
          <img class="l" src="img/logo7.png" alt="">
          <div class="pcnone r">
            <i class="iconfont icon-liebiao meau"></i>
            <i class="iconfont icon-search search"></i>
          </div>
        </div>
        <div class="nav r">
          <div class="pcnone tit"><i class="iconfont icon-zuo"></i>目录</div>
            <div class="navs"> <a id="index" >首页</a> <a id="brand" >公益活动</a> <a id="activity" class="act" >筹款菜单</a> <a id="gerenzhongxin">个人中心</a>  <a id="contact">联系我们</a> </div>
            <div class="pcnone log">
            <a href="../login.html" class="hidelogin">登录</a>
            <a href="register.html" class="hidelogin">注册</a>
            <a href="/">注销登录</a>
            <a href="/">修改密码</a>
          </div>
        </div>
      </div>
    </header>
    <section class="zbanner" style="position: relative">
        <div class="faqichoukuan" style="position: absolute;width: 150px;height: 50px;line-height: 50px;background:orangered;text-align: center;border-radius: 4px;left: 50%;margin-left:-75px;bottom: 30px;cursor: pointer">发起筹款</div>
        <div class="layui-form layuimini-form wenjianshangchuan" style="display: none;width: 25%;height: auto;position: absolute;left: 20%;border-radius: 6px;top: 500px">
            <!-- <input  type="text" name="userId" style="display:none"> -->
                <div class="layui-form-item">
                    <label class="layui-form-label"></label>

                </div>

                <div class="layui-form-item" style="width:800px">
                    <label class="layui-form-label">主图</label>
                    <div class="layui-input-inline" style="width:500px;display:inline-block">
                        <input type="text" name="firstUrl" id="pic_url" placeholder="不上传就留空" autocomplete="off" class="layui-input">
                    </div>
                    <div class="layui-word-aux"style="width:150px;display:inline-block" >
                        <button type="button" class="layui-btn layui-btn-normal" id="pic">
                            <i class="layui-icon ">&#xe67c;</i>上传主图
                        </button>
                    </div>
                </div>

                <div class="layui-form-item" style="width:800px">
                    <label class="layui-form-label required">筹款标题</label>
                    <div class="layui-input-inline" style="width:500px;display:inline-block">
                        <input type="text" name="raisingTitle" lay-verify="required" placeholder="输入筹款标题" value="" class="layui-input">
                    </div>
                </div>

                <div class="layui-form-item" style="width:800px">
                    <label class="layui-form-label required">筹款描述</label>
                    <div class="layui-input-inline" style="width:500px;display:inline-block">
                        <input type="text" name="raisingDescription"   placeholder="请输入描述信息" value="" class="layui-input">
                    </div>
                </div>

                <div class="layui-form-item" style="width:800px">
                    <label class="layui-form-label required">筹款金额</label>
                    <div class="layui-input-inline" style="width:500px;display:inline-block">
                        <input type="number" name="targetAmount" lay-verify="required"  placeholder="请输入金额" value="" class="layui-input">
                    </div>
                </div>
                <div class="layui-form-item" style="width:800px">
                    <label class="layui-form-label">银行卡号</label>
                    <div class="layui-input-inline" style="width:500px;display:inline-block">
                        <input type="number" name="bankNum"  placeholder="请输入银行卡号" value="" class="layui-input">
                    </div>
                </div>
                <div class="layui-form-item" style="width:800px">
                    <label class="layui-form-label">筹款人姓名</label>
                    <div class="layui-input-inline" style="width:500px;display:inline-block">
                        <input type="text" name="raisingName"  placeholder="输入筹款人姓名" value="" class="layui-input">
                    </div>
                </div>
                <fieldset class="layui-elem-field layui-field-title" style="margin-top: 30px;width:560px">
                    <legend>上传副图</legend>
                </fieldset>

                <div class="layui-form-item">
                    <div class="layui-input-inline">
                        <input class="layui-hide" name="imageUrls" type="text" id="imagurls">
                    </div>
                    <blockquote class="layui-input-block layui-elem-quote layui-quote-nm" style="margin-top: 10px;width:450px">

            <!--            <label class="layui-form-label required">预览图：</label>-->
                        <div class="layui-upload-list" id="demo2"> <button type="button" class="layui-btn" id="test2">+</button></div>
                    </blockquote>
                </div>
                <div class="layui-form-item">
                    <div class="layui-input-block">
                        <button class="layui-btn layui-btn-normal" lay-submit lay-filter="saveBtn">确认保存</button>
                    </div>
                </div>
            </div>
    </section>
    <section class="activity" >
      <div class="cont">
        <div class="act_ul">
        </div>
          <div id="pageParent" class="pageParent"></div>
      </div>
    </section>
    <section style="display:none;padding-top:100px;padding-bottom:30px;height:750px" class="showplay">
      <div style="width:100%;height:auto;text-align:center">
        <h1 style="font-weight:bold" class="choukauntitle"></h1>
        <div style="padding-top:20px">
          <span style="color:black;font-weight:bold;padding-right:14px">被资助对象：</span><span class="raisingName"></span>
        </div>
        <div  style="padding-top:20px;margin-bottom:10px">
          <span style="color:coral">
                急需筹款（元）|
            <span style="color:#444;font-weight:bold" class="jxcksum"></span>
          </span>
          <span  style="color:coral;padding-left:14px">
                已经筹到 &nbsp;|
              <span style="color:#444;font-weight:bold" class="yjcdsum"></span>
          </span>
        </div>
          <div class="futu">
              </div>
        <div style="width:60%;margin:0 auto;padding-bottom:30px">
          <h4 style="font-size:20px;font-weight:bold;padding-top:20px">求助人故事</h4>
          <p style="padding-top:20px" class="raisingDescription">
          </p>

        </div>
        <div>
            <input class="moneys" style="width:500px;margin-bottom:20px;height:50px" type="text" placeholder="请输入捐款金额"  />
          </div>
        <a  class="querenjuankuan"  style="display: block;width:150px;height:50px;text-align:center;line-height:50px;background:chocolate;border-radius:10px;margin:0 auto;cursor:pointer">确认捐款</a>
      </div>
    </section>
    <footer class="hidefooter">
        <div class="footer">
            <div>
                <ul>
                    <li><a href="">关于我们</a></li>
                    <li><a href="">服务条款</a></li>
                    <li><a href="">新手指南</a></li>
                    <li><a href="">个人中心</a></li>
                    <li><a href="">联系我们</a></li>
                    <li><a href="">友情链接</a></li>
                </ul>
                <p class="center">版权所有 © 后勤饮食服务中心管理系统. 2020@CopyRight</p>
            </div>
        </div>
    </footer>
    <script>
        $("#gerenzhongxin").click(function (){
            if (sessionStorage.getItem("uesrname") !== null){
                window.location.href = 'shop.html'
            }else{
                alert("请登录！！")
                window.location.href = '../login.html'
            }
        });
        var runCallback1 = null;
        dmm({
            // index: 1,//当前页面                         默认1
            cssStyle: 1,//控件样式                       默认1
            // size: [10, 20, 30],//每页显示条数           默认[10,20]
            // skip: true,//是否显示跳转功能               默认不显示
            // setSize: true,//是否显示下拉框              默认不显示
            container: "pageParent",//控件容器id,
            //textShow: ["首页", "上一页", "下一页", "尾页", "跳转","页","确定","页数：", "总条数："],//长度必须是九个
            //回掉函数，一般就是post请求后台方法得到分页数据加载到页面上
            callback: function (e) {
                e.index;//当前页
                e.pageSize1;//页面显示条数
                var token = sessionStorage.getItem("token")
                //以上两个属性可以当作请求后台时传入的参数
                $.ajax({
                    type:'post',
                    url:'http://localhost:8080/raisinginfo/selectPassRaisingInPage.do',
                    dataType:'json',
                    headers:{"token":token},
                    data:{'currentPage': e.index, 'pageSize': e.pageSize1},
                    success:function (result){
                        console.log("aaaaaa")
                        console.log(result)
                        console.log("aaaaaa")
                        if (result.code == 200){
                            $(".act_ul").empty();
                            $.each(result.obj.pageData,function (index,elem){
                                $(".act_ul").append("<div class='act_li'><div class='act_img'><img style='width:100%;height:300px' src="+'http://localhost:8080'+elem.firstUrl+"></div><div class='act_text' style='position:relative'><h3>"+elem.raisingTitle+"</h3><p><span style='color:coral'><span style='font-size: 18px'>"+elem.targetAmount+"</span><span style='color:#444;font-size: 18px'>急需筹款（元）|</span></span><span style='color:coral;padding-left:14px'><span style='font-size: 18px'>"+elem.currentAmount+"</span><span style='color:#444;font-size: 18px'>已经筹到 &nbsp;</span></span></p><a>立即捐款</a></div></div>")
                                $(".act_text").each(function (index){
                                    $(this).find("a").addClass("juankuan"+(index+1))
                                })
                                $(".juankuan"+(index+1)).click(function(){
                                    sessionStorage.setItem("ckid", elem.id);
                                    var ckid = sessionStorage.getItem("ckid")
                                    $(".zbanner").css("display","none")
                                    $(".activity").css("display","none")
                                    $(".showplay").css("display","block")
                                    var token = sessionStorage.getItem("token")
                                    $.ajax({
                                        type:'post',
                                        url:'http://localhost:8080/raisinginfo/selectRaisingById.do',
                                        dataType:'json',
                                        headers:{"token":token},
                                        data: {'id':ckid},
                                        success:function (result){
                                            console.log(result)
                                        if (result.code=200 ){
                                            $(".choukauntitle").html(result.obj.raisingTitle)
                                            $(".raisingName").html(result.obj.raisingName)
                                            $(".jxcksum").html(result.obj.targetAmount)
                                            $(".yjcdsum").html(result.obj.currentAmount)
                                            $(".raisingDescription").html(result.obj.raisingDescription)
                                            $.each(result.obj.urls,function(index,elem){
                                                console.log(elem)
                                                $(".futu").append("<img style='width:20%;height:200px' src="+'http://localhost:8080'+elem.imageUrl+">")
                                            })

                                        }else{

                                    }
                                }
                                });
                                });
                            })

                        }
                        //以下三行在加载完页面后必须填写
                        e.countpage = Math.ceil(result.obj.totalCount / e.pageSize1);//注意必写（数据总页数——通过后台方法获取）
                        e.infocount = result.obj.totalCount;//注意必写（数据总条数——通过后台方法获取）
                        xian(e);//注意必写（加载控件）
                        //
                        //可将以下代码用于查询使用--联合dian()方法
                        runCallback1 = e;//将分页条件赋值变量
                    }
                })
            }
        });

        function dian() {
            runCallback1.index = 1;

            hui(runCallback1);//执行此分页的回掉函数（请求后台获取数据的方法）
        }

        var arrtext=[];
        var arr1=["first", "up", "next", "last", "jump", "page", "ok", "pageindex: ", "all: "];
        arrtext.push(arr1);
    </script>
    <script type="text/javascript">
      $(function () {
        $('.xiala').click(function () {
          $('.lang ul').toggle();
        })
        $('.lang ul li').click(function () {
          var text =  $(this).html();
          $('.lang span').html(text);
          $('.lang ul').hide();
        })
      })
      window.onload = function (){
          $("#index").click(function (){
              window.location.href = 'index.html'
          })
          $("#brand").click(function (){
              window.location.href = 'brand.html'
          })
          // $("#activity").click(function (){
          //     window.location.href = 'activity.html'
          // })
          $("#activity").click(function (){
              if (sessionStorage.getItem("uesrname") !== null){
                  window.location.href = 'shop.html'
              }else{
                  alert("请登录！！")
                  window.location.href = '../login.html'
              }
          })
          $("#contact").click(function (){
              window.location.href = 'contact.html'
          })
        if (sessionStorage.getItem("uesrname") != null){
          $(".hidelogin").css('display','none');
          $(".hidelogin").css('display','none');
          $("#user").html(sessionStorage.getItem("uesrname"))
          console.log(sessionStorage.getItem("uesrname"))
        }else{
            $("#user").html("登录")
            if ( $("#user").html() == '登录'){
                $('#user').css("cursor","pointer")
                $('#user').click(function (){
                    window.location.href = '../login.html'
                })
            }else{
                console.log("用户已登录")
            }
        }
      }
      function myFunction() {
          var txt;
          if (confirm("是否要退出登录")) {
              txt = "您按了确定";
              sessionStorage.removeItem("uesrname");
              sessionStorage.removeItem("token");
              window.location.href = '../login.html'
          } else {
              txt = "您按了取消";
          }
      };

      function myFunctionupdate() {
          var txt;
          var id = sessionStorage.getItem("id");
          var token = sessionStorage.getItem("token");
          // debugger;
          var password = prompt("请输入密码：");
          var passwordtwo = prompt("请再次输入密码：");
          var parms = {'id': id, 'password': password}
          if (password == null || password == "" ||passwordtwo == null || passwordtwo == "") {
              alert("密码不能为空")
          } else if(password !=passwordtwo ){
              alert("俩次输入密码不一致")
          }else{
              $.ajax({
                  type:'post',
                  url:'http://localhost:8080/admin/update.do',
                  dataType:'json',
                  contentType:'application/json',
                  headers:{"token":token},
                  data:JSON.stringify(parms),
                  success:function (result){
                      console.log(result)
                      if (result.code == 0){
                          alert("密码修改成功，请重新登录")
                          sessionStorage.removeItem("uesrname");
                          sessionStorage.removeItem("id");
                          // window.location.reload();
                          window.location.href='../login.html'
                      }
                  }
              })
          }
      }
    </script>
    <script>
      $(".faqichoukuan").click(function (){
          $(".activity").css("display","none")
          $(".wenjianshangchuan").css("display","block")
          $(".hidefooter").css("display","none")
      });
      $(".queding").click(function (){
          $(".activity").css("display","block")
          $(".wenjianshangchuan").css("display","none")
      });
    </script>
<script>
    $(".querenjuankuan").click(function (){
        var id = sessionStorage.getItem("ckid");
        var userid = sessionStorage.getItem("id");
        var token = sessionStorage.getItem("token");
        var moneys = $(".moneys").val()
        if ($(".moneys").val()!= null && $(".moneys").val() != ""){
            $.ajax({
                type:'post',
                url:'http://localhost:8080/raisinginfo/addAmount.do',
                dataType:'json',
                headers:{"token":token},
                data: {'id':id,'userId':userid,'add':moneys},
                success:function (result){
                    console.log(result)
                    if (result.code=200 ){
                        location.reload();
                        alert(result.message)
                    }else{
                        alert(result.message)
                    }
                }
            })
            // $.ajax({
            //     type:'post',
            //     url:'http://localhost:8080/raisinginfo/selectAmount.do',
            //     dataType:'json',
            //     data: {'userId':userid},
            //     success:function (result){
            //         if (result.code!=200 ){
            //             alert("超出捐款金额")
            //         }
            //     }
            // })
        }else{
            alert("请输入金额")
        }


    })
</script>
  <script>
        const token = sessionStorage.token
        // console.log(token)
        layui.use(['form','upload'], function () {
            var form = layui.form,
                layer = layui.layer,
                upload = layui.upload,
                $ = layui.$;
            // const context = layui.context;
            var hostUrl = "http://localhost:8080"
            upload.render({
                elem: '#pic' //绑定元素
                , url: hostUrl+"/file/upload.do" //上传接口
                ,headers:{"token":token}
                ,exts: 'jpg|png|jpeg'
                , done: function (res) {
                    debugger
                    console.log(res.data)
                    //上传完毕回调
                    if (res.code === 0) {

                        $('#pic_url').val(res.data);
                        //$(".pic_url").attr("src", hostUrl+res.data);
                    } else {
                        layer.msg(res.info, function () { })
                    }
                }, error: function () {
                    layer.msg("上传异常");
                }
            });
            //json的length
            function getJsonLength(jsonData){
                var jsonLength = 0;
                for(var item in jsonData){
                    jsonLength++;
                }
                return jsonLength;
            }
            var imagesUrls = ""
            upload.render({
                elem: '#test2'
                ,url: hostUrl+'/file/upload.do' //改成您自己的上传接口
                ,acceptMime: 'image/*'
                ,exts: 'jpg|png|jpeg'
                ,headers:{"token":token}
                ,multiple: true
                ,number: 3
                ,before: function(obj){
                    //预读本地文件示例，不支持ie8
                    obj.preview(function(index, file, result){
                        $('#demo2').prepend('<img style="width:30px;height:30px" src="'+ result +'" alt="'+ file.name +'" class="layui-upload-img">')
                        if ($('#demo2').children('img').length>=3){
                            $("#test2").hide();
                        }
                    });

                }
                ,done: function(res){

                    imagesUrls = imagesUrls+res.data+","
                    console.log(imagesUrls)
                    $("#imagurls").val(imagesUrls.substring(0,imagesUrls.length-1));
                    console.log($("#imagurls").val())
                    //上传完毕
                }
            });
            //监听提交
            form.on('submit(saveBtn)', function (data) {
                console.log(data.field)
                var token = sessionStorage.getItem("token");
                    $.ajax({
                        url:hostUrl+'/raisinginfo/insertRaising.do',
                        //contentType: "application/json;charset=UTF-8",
                        method:'post',
                        crossDomain: true,
                        async:false,
                        headers:{"token":token},
                        data:data.field,
                        dataType:'JSON',
                        success:function(res){
                            console.log(res)
                            layer.msg(res.msg,{
                                time: 1000, //0.8s后自动关闭
                                icon:1,
                                end:function () {
                                    var iframeIndex = parent.layer.getFrameIndex(window.name);
                                    parent.layer.close(iframeIndex);
                                }
                            });
                            $(".wenjianshangchuan").css("display","none")
                            $(".activity").css("display","block")
                        },error:function (res) {
                        }
                    }) ;
                return false;
            });

        });
    </script>
</body>
</html>
